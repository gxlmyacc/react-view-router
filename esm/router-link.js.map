{"version":3,"sources":["../src/router-link.ts"],"names":["guardEvent","e","metaKey","altKey","ctrlKey","shiftKey","defaultPrevented","button","undefined","currentTarget","getAttribute","target","test","preventDefault","createRouterLink","router","RouterLink","props","state","inited","currentRoute","parentRoute","unplugin","plugin","name","onRouteChange","setState","routerView","nextProps","nextState","to","replace","tag","activeClass","exact","exactActiveClass","event","append","children","remainProps","current","linkActiveClass","linkExactActiveClass","fallbackClass","path","startsWith","className","Array","isArray","events","forEach","evt","push","href","React","createElement","Object","assign","Component","propTypes","PropTypes","oneOfType","string","object","isRequired","bool","elementType","arrayOf","func","defaultProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport {\n  camelize,\n  normalizeLocation,\n  isRouteChanged,\n  getHostRouterView\n} from './util';\n\nfunction guardEvent(e: any) {\n  // don't redirect with control keys\n  if (e.metaKey || e.altKey || e.ctrlKey || e.shiftKey) return;\n  // don't redirect when preventDefault called\n  if (e.defaultPrevented) return;\n  // don't redirect on right click\n  if (e.button !== undefined && e.button !== 0) return;\n  // don't redirect if `target=\"_blank\"`\n  if (e.currentTarget && e.currentTarget.getAttribute) {\n    const target = e.currentTarget.getAttribute('target');\n    if (/\\b_blank\\b/i.test(target)) return;\n  }\n  // this may be a Weex event which doesn't have this method\n  if (e.preventDefault) {\n    e.preventDefault();\n  }\n  return true;\n}\n\ninterface RouterLinkProps {\n  tag: string,\n  event: string | string[],\n  activeClass: string,\n  exactActiveClass: string,\n  to: string | { path: string },\n\n  exact?: boolean,\n  replace?: boolean,\n  append?: boolean,\n\n  children: React.ReactNode[],\n\n  className?: string;\n  href?: string;\n  onRouteChange?: (route: any) => void;\n\n  [key: string]: any;\n}\n\ninterface RouterLinkState {\n  inited: boolean;\n  currentRoute: any;\n  parentRoute: any;\n}\n\nexport default function createRouterLink(router: any): any {\n  class RouterLink extends React.Component<RouterLinkProps, RouterLinkState> {\n\n    static propTypes: any;\n\n    static defaultProps: {\n      tag: string,\n      activeClass: string,\n      exactActiveClass: string,\n      event: string\n    };\n\n    private unplugin?: () => void;\n\n    constructor(props: RouterLinkProps) {\n      super(props);\n      this.state = {\n        inited: false,\n        currentRoute: router.currentRoute,\n        parentRoute: null\n      };\n    }\n\n    componentDidMount() {\n      this.unplugin = router.plugin({\n        name: 'router-link-plugin',\n        onRouteChange: (currentRoute: any) => {\n          this.setState({ currentRoute });\n          if (this.props.onRouteChange) this.props.onRouteChange(currentRoute);\n        }\n      });\n      let routerView = getHostRouterView(this);\n      this.setState({\n        inited: true,\n        parentRoute: routerView ? routerView.state.currentRoute : null\n      });\n    }\n\n    componentWillUnmount() {\n      if (this.unplugin) {\n        this.unplugin();\n        this.unplugin = undefined;\n      }\n    }\n\n    shouldComponentUpdate(nextProps: any, nextState: any) {\n      if (this.props.to !== nextProps.to) return true;\n      if (this.props.replace !== nextProps.replace) return true;\n      if (this.props.tag !== nextProps.tag) return true;\n      if (this.props.activeClass !== nextProps.activeClass) return true;\n      if (this.props.exact !== nextProps.exact) return true;\n      if (this.props.exactActiveClass !== nextProps.exactActiveClass) return true;\n      if (this.props.event !== nextProps.event) return true;\n      if (this.state.inited !== nextState.inited) return true;\n      if (isRouteChanged(this.state.parentRoute, nextState.parentRoute)) return true;\n      if (isRouteChanged(this.state.currentRoute, nextState.currentRoute)) return true;\n      return false;\n    }\n\n    render() {\n      if (!this.state.inited) return null;\n\n      let {\n        tag, to, exact, replace, append, event,\n        children = [], activeClass, exactActiveClass, ...remainProps\n      } = this.props;\n      const current = this.state.currentRoute;\n      to = normalizeLocation(to, this.state.parentRoute, append) as { path: string };\n\n      if (router.linkActiveClass) activeClass = router.linkActiveClass;\n      if (router.linkExactActiveClass) exactActiveClass = router.linkExactActiveClass;\n\n      const fallbackClass = exact\n        ? to.path === current.path ? exactActiveClass : ''\n        : current.path.startsWith(to.path) ? activeClass : '';\n\n      if (fallbackClass) {\n        if (remainProps.className) remainProps.className = `${fallbackClass} ${remainProps.className}`;\n        else remainProps.className = fallbackClass;\n      }\n\n      if (!Array.isArray(event)) event = [event];\n\n      const events: { [key: string]: (e: any) => void; } = {};\n      event.forEach(evt => {\n        events[camelize(`on-${evt}`)] = (e: any) => {\n          guardEvent(e);\n          if (replace) router.replace(to);\n          else router.push(to);\n        };\n      });\n\n      if (tag === 'a') remainProps.href = to.path;\n\n      return React.createElement(tag, Object.assign(remainProps, events), ...children);\n    }\n\n  }\n\n  RouterLink.propTypes = {\n    to: PropTypes.oneOfType([PropTypes.string, PropTypes.object]).isRequired,\n    replace: PropTypes.bool,\n    append: PropTypes.bool,\n    tag: PropTypes.oneOfType([PropTypes.string, PropTypes.elementType]),\n    activeClass: PropTypes.string,\n    exact: PropTypes.bool,\n    exactActiveClass: PropTypes.string,\n    event: PropTypes.oneOfType([PropTypes.string, PropTypes.arrayOf(PropTypes.string)]),\n    onRouteChange: PropTypes.func\n  };\n\n  RouterLink.defaultProps = {\n    tag: 'a',\n    activeClass: 'router-link-active',\n    exactActiveClass: 'exact-active-class',\n    event: 'click'\n  };\n\n  return RouterLink;\n}\n"],"file":"router-link.js"}