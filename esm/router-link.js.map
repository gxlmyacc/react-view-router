{"version":3,"sources":["../src/router-link.ts"],"names":["guardEvent","e","metaKey","altKey","ctrlKey","shiftKey","defaultPrevented","button","undefined","currentTarget","getAttribute","target","test","preventDefault","createRouterLink","router","RouterLink","props","state","inited","currentRoute","parentRoute","unplugin","plugin","name","onRouteChange","setState","routerView","nextProps","nextState","to","replace","tag","activeClass","exact","exactActiveClass","event","append","children","remainProps","current","linkActiveClass","linkExactActiveClass","fallbackClass","path","startsWith","className","Array","isArray","events","forEach","evt","push","href","React","createElement","Object","assign","Component","propTypes","PropTypes","oneOfType","string","object","isRequired","bool","elementType","arrayOf","func","defaultProps"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport {\r\n  camelize,\r\n  normalizeLocation,\r\n  isRouteChanged,\r\n  getHostRouterView\r\n} from './util';\r\n\r\nfunction guardEvent(e: any) {\r\n  // don't redirect with control keys\r\n  if (e.metaKey || e.altKey || e.ctrlKey || e.shiftKey) return;\r\n  // don't redirect when preventDefault called\r\n  if (e.defaultPrevented) return;\r\n  // don't redirect on right click\r\n  if (e.button !== undefined && e.button !== 0) return;\r\n  // don't redirect if `target=\"_blank\"`\r\n  if (e.currentTarget && e.currentTarget.getAttribute) {\r\n    const target = e.currentTarget.getAttribute('target');\r\n    if (/\\b_blank\\b/i.test(target)) return;\r\n  }\r\n  // this may be a Weex event which doesn't have this method\r\n  if (e.preventDefault) {\r\n    e.preventDefault();\r\n  }\r\n  return true;\r\n}\r\n\r\ninterface RouterLinkProps {\r\n  tag: string,\r\n  event: string | string[],\r\n  activeClass: string,\r\n  exactActiveClass: string,\r\n  to: string | { path: string },\r\n\r\n  exact?: boolean,\r\n  replace?: boolean,\r\n  append?: boolean,\r\n\r\n  children: React.ReactNode[],\r\n\r\n  className?: string;\r\n  href?: string;\r\n  onRouteChange?: (route: any) => void;\r\n\r\n  [key: string]: any;\r\n}\r\n\r\ninterface RouterLinkState {\r\n  inited: boolean;\r\n  currentRoute: any;\r\n  parentRoute: any;\r\n}\r\n\r\nexport default function createRouterLink(router: any): any {\r\n\r\n  class RouterLink extends React.Component<RouterLinkProps, RouterLinkState> {\r\n\r\n    static propTypes: any;\r\n    static defaultProps: any;\r\n\r\n    private unplugin?: () => void;\r\n\r\n    constructor(props: RouterLinkProps) {\r\n      super(props);\r\n      this.state = {\r\n        inited: false,\r\n        currentRoute: router.currentRoute,\r\n        parentRoute: null\r\n      };\r\n    }\r\n\r\n    componentDidMount() {\r\n      this.unplugin = router.plugin({\r\n        name: 'router-link-plugin',\r\n        onRouteChange: (currentRoute: any) => {\r\n          this.setState({ currentRoute });\r\n          if (this.props.onRouteChange) this.props.onRouteChange(currentRoute);\r\n        }\r\n      });\r\n      let routerView = getHostRouterView(this);\r\n      this.setState({\r\n        inited: true,\r\n        parentRoute: routerView ? routerView.state.currentRoute : null\r\n      });\r\n    }\r\n\r\n    componentWillUnmount() {\r\n      if (this.unplugin) {\r\n        this.unplugin();\r\n        this.unplugin = undefined;\r\n      }\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps: any, nextState: any) {\r\n      if (this.props.to !== nextProps.to) return true;\r\n      if (this.props.replace !== nextProps.replace) return true;\r\n      if (this.props.tag !== nextProps.tag) return true;\r\n      if (this.props.activeClass !== nextProps.activeClass) return true;\r\n      if (this.props.exact !== nextProps.exact) return true;\r\n      if (this.props.exactActiveClass !== nextProps.exactActiveClass) return true;\r\n      if (this.props.event !== nextProps.event) return true;\r\n      if (this.state.inited !== nextState.inited) return true;\r\n      if (isRouteChanged(this.state.parentRoute, nextState.parentRoute)) return true;\r\n      if (isRouteChanged(this.state.currentRoute, nextState.currentRoute)) return true;\r\n      return false;\r\n    }\r\n\r\n    render() {\r\n      if (!this.state.inited) return null;\r\n\r\n      let {\r\n        tag, to, exact, replace, append, event,\r\n        children = [], activeClass, exactActiveClass, ...remainProps\r\n      } = this.props;\r\n      const current = this.state.currentRoute;\r\n      to = normalizeLocation(to, this.state.parentRoute, append) as { path: string };\r\n\r\n      if (router.linkActiveClass) activeClass = router.linkActiveClass;\r\n      if (router.linkExactActiveClass) exactActiveClass = router.linkExactActiveClass;\r\n\r\n      const fallbackClass = exact\r\n        ? to.path === current.path ? exactActiveClass : ''\r\n        : current.path.startsWith(to.path) ? activeClass : '';\r\n\r\n      if (fallbackClass) {\r\n        if (remainProps.className) remainProps.className = `${fallbackClass} ${remainProps.className}`;\r\n        else remainProps.className = fallbackClass;\r\n      }\r\n\r\n      if (!Array.isArray(event)) event = [event];\r\n\r\n      const events: { [key: string]: (e: any) => void; } = {};\r\n      event.forEach(evt => {\r\n        events[camelize(`on-${evt}`)] = (e: any) => {\r\n          guardEvent(e);\r\n          if (replace) router.replace(to);\r\n          else router.push(to);\r\n        };\r\n      });\r\n\r\n      if (tag === 'a') remainProps.href = to.path;\r\n\r\n      return React.createElement(tag, Object.assign(remainProps, events), ...children);\r\n    }\r\n\r\n  }\r\n\r\n  RouterLink.propTypes = {\r\n    to: PropTypes.oneOfType([PropTypes.string, PropTypes.object]).isRequired,\r\n    replace: PropTypes.bool,\r\n    append: PropTypes.bool,\r\n    tag: PropTypes.oneOfType([PropTypes.string, PropTypes.elementType]),\r\n    activeClass: PropTypes.string,\r\n    exact: PropTypes.bool,\r\n    exactActiveClass: PropTypes.string,\r\n    event: PropTypes.oneOfType([PropTypes.string, PropTypes.arrayOf(PropTypes.string)]),\r\n    onRouteChange: PropTypes.func\r\n  };\r\n\r\n  RouterLink.defaultProps = {\r\n    tag: 'a',\r\n    activeClass: 'router-link-active',\r\n    exactActiveClass: 'exact-active-class',\r\n    event: 'click'\r\n  };\r\n\r\n  return RouterLink;\r\n}\r\n"],"file":"router-link.js"}