{"version":3,"sources":["../src/index.ts"],"names":["RouterDrawer","props","Object","assign","state","openDrawer","prevRoute","_routerDrawer","_handleClose","bind","_handleAnimationEnd","currentRoute","newState","isNull","r","_routerParent","keys","componentInstances","forEach","key","c","componentWillUnactivate","componentDidActivate","undefined","position","_routerInited","setState","router","parentRoute","path","back","config","zIndexStart","zIndex","view","depth","zIndexStep","nextProps","nextState","routes","_updateRef","oldContainer","container","prefixCls","delay","drawerClassName","children","touch","query","params","defineProperty","get","drawer","configurable","ret","name","comp","hasPrev","React","createElement","Drawer","ref","el","className","transitionName","open","Boolean","getZindex","onAnimateLeave","onClose","RouterViewComponent","defaultProps","forwardRef"],"mappings":"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","sourcesContent":["import React from 'react';\nimport {\n  RouterViewComponent,\n  RouterViewProps,\n  RouterViewState,\n  renderRoute,\n  config,\n  isFunction,\n  RouterViewDefaultProps,\n  ConfigRoute\n} from 'react-view-router';\nimport Drawer from './drawer';\n\nimport '../style/drawer.css';\n\nexport interface RouterDrawerProps extends RouterViewProps {\n  [key: string]: any\n}\n\nexport interface RouterDrawerState extends RouterViewState {\n  openDrawer?: boolean,\n  _routerDrawer?: boolean,\n  prevRoute?: ConfigRoute | null,\n}\n\nexport interface RouterDrawerDefaultProps extends RouterViewDefaultProps {\n  prefixCls: string,\n  position: string,\n  touch: boolean,\n}\n\nclass RouterDrawer<\n  P extends RouterDrawerProps = RouterDrawerProps,\n  S extends RouterDrawerState = RouterDrawerState,\n  SS = any\n> extends RouterViewComponent<P, S, SS> {\n\n  drawer?: Drawer | null;\n\n  static defaultProps: RouterDrawerDefaultProps;\n\n  constructor(props: P) {\n    super(props);\n    Object.assign(this.state, {\n      openDrawer: false,\n      prevRoute: null,\n      _routerDrawer: true\n    });\n    this._handleClose = this._handleClose.bind(this);\n    this._handleAnimationEnd = this._handleAnimationEnd.bind(this);\n  }\n\n  _refreshCurrentRoute(state: S) {\n    if (!state) state = this.state;\n    const prevRoute = state.currentRoute;\n    const newState: any = { openDrawer: false };\n    const currentRoute = super._refreshCurrentRoute(state, newState);\n    let openDrawer;\n    if (this.isNull(prevRoute) && !this.isNull(currentRoute)) {\n      let r = state._routerParent && state._routerParent.state.currentRoute;\n      r && Object.keys(r.componentInstances).forEach(key => {\n        const c = r && r.componentInstances[key];\n        if (c && c.componentWillUnactivate) c.componentWillUnactivate();\n      });\n      openDrawer = true;\n    }\n    if (!this.isNull(prevRoute) && this.isNull(currentRoute)) {\n      let r = state._routerParent && state._routerParent.state.currentRoute;\n      r && Object.keys(r.componentInstances).forEach(key => {\n        const c = r && r.componentInstances[key];\n        if (c && c.componentDidActivate) c.componentDidActivate();\n      });\n      openDrawer = false;\n    }\n    if (openDrawer !== undefined && this.state.openDrawer !== openDrawer) {\n      newState.openDrawer = openDrawer;\n      if (!openDrawer && this.props.position) newState.prevRoute = prevRoute;\n    }\n\n    if (this.state && this.state._routerInited) this.setState(newState);\n    else Object.assign(state, newState);\n\n    return currentRoute;\n  }\n\n  _handleAnimationEnd() {\n    if (!this.props.position) return;\n    if (!this.state.openDrawer) this.setState({ prevRoute: null });\n  }\n\n  _handleClose() {\n    const { router, parentRoute } = this.state;\n    if (router) {\n      if (parentRoute && router.currentRoute && router.currentRoute.path !== parentRoute.path) router.back();\n    }\n    this.setState({ openDrawer: false });\n  }\n\n  getZindex() {\n    const currentRoute = this.state.currentRoute;\n    if (!currentRoute) return config.zIndexStart;\n    const { zIndex } = this.props;\n    if (zIndex !== undefined) {\n      if (isFunction(zIndex)) return zIndex(currentRoute, { config, view: this });\n      return zIndex;\n    }\n    return config.zIndexStart + currentRoute.depth * config.zIndexStep;\n  }\n\n  shouldComponentUpdate(nextProps: P, nextState: S) {\n    if (this.state.openDrawer !== nextState.openDrawer) return true;\n    if (this.state.prevRoute !== nextState.prevRoute) return true;\n    return super.shouldComponentUpdate(nextProps, nextState);\n  }\n\n  renderCurrent(currentRoute: ConfigRoute) {\n    const { routes } = this.state;\n    if (!this.state.router) return null;\n    // eslint-disable-next-line\n    const { _updateRef, router, container: oldContainer, prefixCls, position, zIndexStart, delay,\n      drawerClassName, children, touch, ...props\n    } = this.props;\n    const { openDrawer, prevRoute } = this.state;\n    const { query, params } = this.state.router.currentRoute || {};\n\n    Object.defineProperty(props, 'drawer', {\n      get() {\n        return this.drawer;\n      },\n      configurable: true\n    });\n\n    let ret = renderRoute(\n      !openDrawer ? prevRoute : currentRoute,\n      routes, props,\n      children,\n      {\n        name: this.name,\n        query,\n        params,\n        container: (comp: any) => {\n          if (oldContainer) comp = oldContainer(comp, currentRoute, props as any);\n          const hasPrev = this.state.router && !this.isNull(this.state.router.prevRoute);\n          comp = React.createElement(Drawer, {\n            ref: (el: Drawer | null) => this.drawer = el,\n            prefixCls,\n            className: drawerClassName,\n            touch: touch && hasPrev,\n            transitionName: (hasPrev && position) ? `rvr-slide-${position}` : '',\n            open: Boolean(openDrawer && comp),\n            zIndex: this.getZindex(),\n            onAnimateLeave: this._handleAnimationEnd,\n            onClose: this._handleClose,\n          } as any, comp);\n          return comp;\n        },\n        ref: this._updateRef\n      }\n    );\n\n    return ret;\n  }\n\n}\n\nRouterDrawer.defaultProps = {\n  ...RouterViewComponent.defaultProps,\n  prefixCls: 'rvr-route-drawer',\n  position: 'right',\n  touch: true,\n};\n\nexport default React.forwardRef((props, ref) => React.createElement(RouterDrawer as any, {\n  ...props,\n  _updateRef: ref\n}));\n"],"file":"index.js"}